name: coq
version: 0.0.3
description: wercker box for the latest Coq
type: main
platform: ubuntu@12.04
keywords:
  - coq
packages:
  - coq@8.4pl6
script: |
  # variables
  export COQ_VER=8.4pl6

  # install dependencies
  sudo apt-get update -y
  sudo apt-get install -y make m4 python-software-properties

  # install ocaml and opam
  sudo add-apt-repository -y ppa:avsm/ppa
  sudo apt-get update
  sudo apt-get install -y ocaml opam
  opam init -y
  eval `opam config env`
  echo 'eval `opam config env`' | sudo tee -a /etc/profile

  # install ocamlfind and camlp5
  opam install -y ocamlfind camlp5

  # install coq
  wget http://coq.inria.fr/distrib/V${COQ_VER}/files/coq-${COQ_VER}.tar.gz
  tar xf coq-${COQ_VER}.tar.gz
  cd coq-${COQ_VER}
  ./configure --prefix /usr/local -camlp5dir `~/.opam/system/bin/ocamlfind query camlp5`
  make world -j4
  sudo make install

  # check
  coqtop -v
